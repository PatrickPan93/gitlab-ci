.code-analysis:
  stage: code-analysis
  image: ${SONAR_SCANNER_IMAGE}
  #tags:
  #  - build
  # multi branches require sonarqube-community-branch-plugin installed in SonarQube Server.
  # -Dsonar.branch.name=${CI_COMMIT_REF_NAME}"
  # https://github.com/mc1arke/sonarqube-community-branch-plugin/tree/master
  script:
    - echo $CI_MERGE_REQUEST_IID $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME $CI_MERGE_REQUEST_TARGET_BRANCH_NAME
    - "sonar-scanner -Dsonar.host.url=http://sonarqube-sonarqube:9000 \
                     -Dsonar.login=admin \
                     -Dsonar.password=pzb19930830 \
                     -Dsonar.projectKey=${CI_PROJECT_NAME} \
                     -Dsonar.projectName=${CI_PROJECT_NAME} \
                     -Dsonar.projectVersion=${CI_COMMIT_REF_NAME} \
                     -Dsonar.ws.timeout=30 \
                     -Dsonar.projectDescription=${CI_PROJECT_TITLE} \
                     -Dsonar.links.homepage=${CI_PROJECT_URL} \
                     -Dsonar.source=${SCAN_DIR} \
                     -Dsonar.sourceEncoding=UTF-8 \
                     -Dsonar.java.binaries=target/classes \
                     -Dsonar.java.test.binaries=target/test-classes \
                     -Dsonar.java.surefire.report=target/surefire-reports \
                     -Dsonar.branch.name=${CI_COMMIT_REF_NAME}"
  artifacts:
    paths:
      - "${ARTIFACT_PATH}"
